<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>RFH | Screenshot Analysis</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;900&family=Roboto:wght@300;400;500&display=swap"
        rel="stylesheet">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/styles.css">
    <style>
        .upload-area {
            border: 2px dashed #333;
            border-radius: 10px;
            padding: 3rem;
            text-align: center;
            transition: all 0.3s ease;
            background-color: #111;
            cursor: pointer;
        }

        .upload-area:hover {
            border-color: #d00000;
            background-color: #1a1a1a;
        }

        .analysis-result {
            display: none;
            margin-top: 2rem;
            padding: 2rem;
            background-color: #111;
            border-left: 4px solid #d00000;
        }
    </style>
</head>

<body class="bg-black text-light">

    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark border-bottom border-secondary">
        <div class="container-fluid px-4">
            <a class="navbar-brand fw-bold text-uppercase tracking-wider" href="index.html">RFH <span
                    class="text-danger">.</span></a>
            <div class="ms-auto">
                <a href="chat.html" class="btn btn-outline-light btn-sm rounded-0 me-2">AI Coach</a>
                <span class="badge bg-danger rounded-0">SCREENSHOT ANALYZER</span>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container py-5">
        <div class="row justify-content-center">
            <div class="col-lg-8 text-center mb-5">
                <h1 class="display-4 fw-bold text-uppercase mb-3">Decode Her Texts</h1>
                <p class="lead text-white-50">Upload a screenshot of your conversation. Our AI will analyze the subtext,
                    detect tests, and tell you exactly what to say next.</p>
            </div>

            <div class="col-lg-8">
                <div class="upload-area" id="uploadTrigger">
                    <div class="mb-3">
                        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="#d00000"
                            class="bi bi-cloud-upload" viewBox="0 0 16 16">
                            <path fill-rule="evenodd"
                                d="M4.406 1.342A5.53 5.53 0 0 1 8 0c2.69 0 4.923 2 5.166 4.579C14.758 4.804 16 6.137 16 7.773 16 9.634 14.606 11 12.75 11H3.25C1.45 11 0 9.634 0 7.773c0-1.636 1.242-2.969 2.834-3.194C3.087 3.949 3.468 3.242 4.406 1.342zM8.167 10H12.75A2.75 2.75 0 0 0 15.5 7.773c0-1.505-1.054-2.736-2.525-2.793-.196-.007-.39-.01-.586-.01H12.1c.025-.33.045-.66.05-1 .09-4.27-5.05-4.27-4.96 0-.005.335-.025.665-.05 1H6.92c-.195 0-.39.003-.586.01-1.47.057-2.525 1.288-2.525 2.793 0 1.505 1.055 2.736 2.525 2.793h4.583z" />
                            <path fill-rule="evenodd"
                                d="M7.646 4.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 5.707V14.5a.5.5 0 0 1-1 0V5.707L5.354 7.854a.5.5 0 1 1-.708-.708l3-3z" />
                        </svg>
                    </div>
                    <h4 class="fw-bold">Click to Upload Screenshot</h4>
                    <p class="text-white-50 small">Supported formats: JPG, PNG</p>
                </div>
                <input type="file" id="fileInput" accept="image/*" style="display: none;">

                <!-- Loading State -->
                <div id="loadingState" class="text-center mt-4" style="display: none;">
                    <div class="spinner-border text-danger" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-2 text-white-50">Analyzing frame and subtext...</p>
                </div>

                <!-- Result Area -->
                <div id="resultArea" class="analysis-result">
                    <h4 class="text-danger fw-bold mb-3">Analysis Complete</h4>
                    <div id="analysisContent"></div>
                    <div class="mt-4">
                        <button class="btn btn-outline-light btn-sm rounded-0" onclick="location.reload()">Analyze
                            Another</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Privacy Modal -->
    <div class="modal fade" id="privacyModal" tabindex="-1" aria-labelledby="privacyModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content bg-dark border-secondary text-light">
                <div class="modal-header border-secondary">
                    <h5 class="modal-title fw-bold text-danger" id="privacyModalLabel">PRIVACY WARNING</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                        aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p class="fw-bold">Before you proceed:</p>
                    <ul class="text-white-50 small">
                        <li class="mb-2">Please <strong>BLUR</strong> any names, phone numbers, or profile photos in
                            your screenshot.</li>
                        <li class="mb-2">We value your privacy. All images are processed in real-time and
                            <strong>IMMEDIATELY DELETED</strong> from our servers after analysis.</li>
                        <li>We do not store or share your personal conversations.</li>
                    </ul>
                    <div class="form-check mt-3">
                        <input class="form-check-input bg-dark border-secondary" type="checkbox" id="privacyCheck">
                        <label class="form-check-label small" for="privacyCheck">
                            I have blurred sensitive info and understand the privacy policy.
                        </label>
                    </div>
                </div>
                <div class="modal-footer border-secondary">
                    <button type="button" class="btn btn-outline-light btn-sm rounded-0"
                        data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger btn-sm rounded-0" id="confirmUpload" disabled>Select
                        Image</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
        crossorigin="anonymous"></script>
    <script>
        const uploadTrigger = document.getElementById('uploadTrigger');
        const fileInput = document.getElementById('fileInput');
        const privacyModal = new bootstrap.Modal(document.getElementById('privacyModal'));
        const privacyCheck = document.getElementById('privacyCheck');
        const confirmUpload = document.getElementById('confirmUpload');
        const loadingState = document.getElementById('loadingState');
        const resultArea = document.getElementById('resultArea');
        const analysisContent = document.getElementById('analysisContent');

        // Open modal on click
        uploadTrigger.addEventListener('click', () => {
            privacyModal.show();
        });

        // Enable button when checked
        privacyCheck.addEventListener('change', () => {
            confirmUpload.disabled = !privacyCheck.checked;
        });

        // Trigger file input
        confirmUpload.addEventListener('click', () => {
            privacyModal.hide();
            fileInput.click();
        });

        // Handle file selection
        fileInput.addEventListener('change', async (e) => {
            if (e.target.files.length > 0) {
                const file = e.target.files[0];
                await analyzeImage(file);
            }
        });

        async function analyzeImage(file) {
            // UI Updates
            uploadTrigger.style.display = 'none';
            loadingState.style.display = 'block';
            resultArea.style.display = 'none';

            const formData = new FormData();
            formData.append('file', file);

            try {
                const response = await fetch('http://127.0.0.1:8000/analyze-screenshot', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                // Simulate processing delay for effect
                setTimeout(() => {
                    loadingState.style.display = 'none';
                    resultArea.style.display = 'block';
                    analysisContent.innerHTML = `
                        <p class="mb-3"><strong>Assessment:</strong> ${data.assessment}</p>
                        <p class="mb-3 text-danger"><strong>Recommended Reply:</strong> "${data.reply}"</p>
                        <p class="small text-white-50"><strong>Why:</strong> ${data.reasoning}</p>
                    `;
                }, 2000);

            } catch (error) {
                console.error('Error:', error);
                loadingState.style.display = 'none';
                uploadTrigger.style.display = 'block';
                alert('Analysis failed. Please try again.');
            }
        }
    </script>
</body>

</html>